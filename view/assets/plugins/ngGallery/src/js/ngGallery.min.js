angular.module("jkuri.gallery",[]).directive("ngGallery",["$document","$timeout","$q","$templateCache",function(e,n,i,t){"use strict";function a(e,n){e.baseClass=e["class"]||l.baseClass,e.thumbClass=e.thumbClass||l.thumbClass,e.thumbsNum=e.thumbsNum||3}var l={baseClass:"ng-gallery",thumbClass:"ng-thumb",templateUrl:"ng-gallery.html"},s={enter:13,esc:27,left:37,right:39},c=l.templateUrl;return t.put(c,'<div class="{{ baseClass }}">  <div ng-repeat="i in images">    <img ng-src="{{ i.thumb }}" class="{{ thumbClass }}" ng-click="openGallery($index)" alt="Image {{ $index + 1 }}" />  </div></div><div class="ng-overlay" ng-show="opened"></div><div class="ng-gallery-content" ng-show="opened">  <div class="uil-ring-css" ng-show="loading"><div></div></div>  <a class="close-popup" ng-click="closeGallery()"><i class="fa fa-close"></i></a>  <a class="nav-left" ng-click="prevImage()"><i class="fa fa-angle-left"></i></a>  <img ng-src="{{ img }}" ng-click="nextImage()" ng-show="!loading" class="effect" />  <a class="nav-right" ng-click="nextImage()"><i class="fa fa-angle-right"></i></a>  <span class="info-text">{{ index + 1 }}/{{ images.length }}{{ description }}</span>  <div class="ng-thumbnails-wrapper">    <div class="ng-thumbnails slide-left">      <div ng-repeat="i in images">        <img ng-src="{{ i.thumb }}" ng-class="{\'active\': index === $index}" ng-click="changeImage($index)" />      </div>    </div>  </div></div>'),{restrict:"EA",scope:{images:"=",thumbsNum:"@"},templateUrl:function(e,n){return n.templateUrl||l.templateUrl},link:function(t,l,c){a(t,c),t.thumbsNum>=11&&(t.thumbsNum=11);var r=e.find("body"),d=angular.element(document.querySelectorAll(".ng-thumbnails-wrapper")),g=angular.element(document.querySelectorAll(".ng-thumbnails"));t.index=0,t.opened=!1,t.thumb_wrapper_width=0,t.thumbs_width=0;var o=function(e){var n=i.defer(),a=new Image;return a.onload=function(){t.loading=!1,(typeof this.complete===!1||0===this.naturalWidth)&&n.reject(),n.resolve(a)},a.onerror=function(){n.reject()},a.src=t.images[e].img,t.loading=!0,n.promise},m=function(e){o(t.index).then(function(e){t.img=e.src,h(t.index)}),t.description=t.images[e].description||""};t.changeImage=function(e){t.index=e,o(t.index).then(function(e){t.img=e.src,h(t.index)})},t.nextImage=function(){t.index+=1,t.index===t.images.length&&(t.index=0),m(t.index)},t.prevImage=function(){t.index-=1,t.index<0&&(t.index=t.images.length-1),m(t.index)},t.openGallery=function(e){void 0!==typeof e&&(t.index=e,m(t.index)),t.opened=!0,n(function(){var e=u();t.thumbs_width=e.width,g.css({width:e.width+"px"}),d.css({width:e.visible_width+"px"}),h(t.index)})},t.closeGallery=function(){t.opened=!1},r.bind("keydown",function(e){if(t.opened){var n=e.which;n===s.esc?t.closeGallery():n===s.right||n===s.enter?t.nextImage():n===s.left&&t.prevImage(),t.$apply()}});var u=function(){var e=0,n=0;return angular.forEach(g.find("img"),function(i){e+=i.clientWidth,e+=10,n=i.clientWidth+10}),{width:e,visible_width:n*t.thumbsNum}},h=function(e){n(function(){var n=t.images.length,i=t.thumbs_width,a=(d[0].scrollLeft,parseInt(i/n,10)),l=e+1,s=Math.ceil(n/l);d[0].scrollLeft=0,d[0].scrollLeft=l*a-s*a},100)}}}}]);