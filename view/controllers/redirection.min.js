sourceAdminApp.controller("redirectionCtrl",["$scope","locServ","$location","sessionService","Auth","apiCall","$window","$http","$rootScope","$cookies","storageService",function(e,t,s,o,r,n,i,c,a,l,u){if(e.deleteParams=function(){s.search("key",null),s.search("service",null),s.search("redirection",null)},e.timezone=jstz.determine(),l.put("timezone",e.timezone.name()),l.remove("entity"),l.get("sellyxtoken")){var d={method:"GET",url:"https://auth.sellyx.com/auth/validate?key="+l.get("sellyxtoken")};n.getapi(d).then(function(e){e.success},function(e){console.log(e)}),req={method:"POST",url:"users/a/get"},n.getapi(req).then(function(t){if(t.success){var o=t.success.data,r={name:o.name,id:o.id,email:o.email};req={method:"POST",url:"users/a/entities/summary"},n.getapi(req).then(function(t){if(t.success)var o=t.success.data;l.put("sellerInfo",JSON.stringify(o)),l.put("entity",o[0].id),req={method:"POST",url:"messages/a/count",failure_message:!0},n.getapi(req).then(function(e){e.success?l.put("messages",e.success.data):console.log(e.failure)},function(e){console.log(e)}),req={method:"POST",url:"listings/a/orders/get/selling/count",failure_message:!0},n.getapi(req).then(function(t){t.success?l.put("orders",t.success.data):console.log(t.failure),s.url(s.search().redirection),e.deleteParams()},function(e){console.log(e)})}),a.firstLogged=!0,l.putObject("userInfo",r),l.put("currency",o.currency),l.put("standard","US")}else console.log("failed getting into user info from the server")},function(e){i.location.href="https://auth.sellyx.com/logout?service=www"})}s.search().redirection&&"redirect"!=s.search().redirection||s.path("/")}]);