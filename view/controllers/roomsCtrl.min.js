sourceAdminApp.controller("roomsCtrl",["$rootScope","$scope","$http","$timeout","$cookies","$location","api","chatWSService","$compile","apiCall","Alertify","storageService",function(o,e,t,n,i,a,r,s,l,c,p,m){function d(){function o(o,t){var c={coords:[1,1,1,20,18,20,18,1],type:"poly"};n.addListener("click",function(t,n){p.setContent(t.html),p.open(o,t),l($(".view-demo"))(e)}),n.addListener("spiderfy",function(o){for(var e=0;e<o.length;e++)o[e].setIcon(r(a)),o[e].setShadow(null);p.close()}),n.addListener("unspiderfy",function(o){for(var e=0;e<o.length;e++)o[e].setIcon(r(i)),o[e].setShadow(s)});for(var m={},d=0;d<e.rooms.length;d++){var u=e.rooms[d];if(!(e.rooms[d].product_id in m)){m[e.rooms[d].product_id]=d;try{var g='<div id=""><div id="siteNotice"><br><div id="bodyContent"><div style="margin-bottom: 10px"><img src="https://sellyx-ecom.s3-us-west-1.amazonaws.com/s_'+u.product_image+'"></div><p><b>Product</b> '+u.product_name+"</p>"+(u.product_description?"<p><b>Description</b> "+u.product_description+"</p>":"")+"<p><b>Price</b> $"+u.product_price+'</p><button type="button" class="btn btn-success view-demo" ng-click="viewDemo(\''+u.room_key+"')\">View Demo</button></div></div>"}catch(h){}var f=new google.maps.Marker({position:{lat:parseFloat(u.location[1]),lng:parseFloat(u.location[0])},map:o,animation:google.maps.Animation.DROP,shape:c,html:g});n.addMarker(f),f[u.user_token]=f}}}var t,n,i="eebb22",a="ffee22",r=function(o){return"http://chart.googleapis.com/chart?chst=d_map_xpin_letter&chld=pin|+|"+o+"|000000|ffff00"},s=new google.maps.MarkerImage("https://www.google.com/intl/en_ALL/mapfiles/shadow50.png",new google.maps.Size(37,34),new google.maps.Point(0,0),new google.maps.Point(10,34)),c={scrollwheel:!1,zoom:9,minZoom:2,maxZoom:13,center:new google.maps.LatLng(e.user_location.latitude,e.user_location.longitude),mapTypeId:google.maps.MapTypeId.ROADMAP};t=new google.maps.Map(document.getElementById("map"),c),n=new OverlappingMarkerSpiderfier(t);var p=new google.maps.InfoWindow;o(t)}function u(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:34.024212,lng:-118.496475},zoom:10,scrollwheel:!1})}e.rooms=[],s.close(),e.sellyxKey=i.get("sellyxtoken"),e.user_location=i.getObject("userloc");var g={method:"GET",url:"https://chatting.sellyx.com/room/list?longitude="+e.user_location.longitude+"&latitude="+e.user_location.latitude+"&radius=1000",headers:{authorization:e.sellyxKey},failure_message:!0};c.getapi(g).then(function(o){if(o.success)if(e.rooms=o.success.data,e.rooms.length>0){for(var t={},n=0;n<e.rooms.length;n++)e.rooms[n].product_id in t?(e.rooms.splice(n,1),n-=1):t[e.rooms[n].product_id]=n;console.log(t),d()}else u();else $("#login_modal").modal("show"),e.url=encodeURIComponent(a.url()),u()},function(o){})["finally"](function(){}),e.viewDemo=function(o){a.path("/chat").search({key:o})},e.viewRoom=function(o){a.path("chat").search({key:o})}}]);