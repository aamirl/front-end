sourceAdminApp.controller("homeCtrl",["$rootScope","$scope","$http","$timeout","$cookies","$location","chatWSService","$compile","api","apiCall","Alertify","angularGridInstance","storageService",function(o,e,t,n,i,a,r,s,c,l,d,u,p){function m(){function o(o,t){var l={coords:[1,1,1,20,18,20,18,1],type:"poly"};n.addListener("click",function(t,n){d.setContent(t.html),d.open(o,t),s($(".view-demo"))(e)}),n.addListener("spiderfy",function(o){for(var e=0;e<o.length;e++)o[e].setIcon(r(a)),o[e].setShadow(null);d.close()}),n.addListener("unspiderfy",function(o){for(var e=0;e<o.length;e++)o[e].setIcon(r(i)),o[e].setShadow(c)});for(var u={},p=0;p<e.rooms.length;p++){var m=e.rooms[p];if(!(e.rooms[p].product_id in u)){u[e.rooms[p].product_id]=p;try{var g='<div id=""><div id="siteNotice"><br><div id="bodyContent"><div style="margin-bottom: 10px"><img src="https://sellyx-ecom.s3-us-west-1.amazonaws.com/s_'+m.product_image+'"></div><p><b>Product</b> '+m.product_name+"</p>"+(m.product_description?"<p><b>Description</b> "+m.product_description+"</p>":"")+"<p><b>Price</b> $"+m.product_price+'</p><button type="button" class="btn btn-success view-demo" ng-click="viewDemo(\''+m.room_key+"')\">View Demo</button></div></div>"}catch(h){}var f=new google.maps.Marker({position:{lat:parseFloat(m.location[1]),lng:parseFloat(m.location[0])},map:o,animation:google.maps.Animation.DROP,shape:l,html:g});n.addMarker(f),f[m.user_token]=f}}}var t,n,i="eebb22",a="ffee22",r=function(o){return"http://chart.googleapis.com/chart?chst=d_map_xpin_letter&chld=pin|+|"+o+"|000000|ffff00"},c=new google.maps.MarkerImage("https://www.google.com/intl/en_ALL/mapfiles/shadow50.png",new google.maps.Size(37,34),new google.maps.Point(0,0),new google.maps.Point(10,34)),l={scrollwheel:!1,zoom:9,minZoom:2,maxZoom:13,center:new google.maps.LatLng(e.user_location.latitude?e.user_location.latitude:e.user_location.lat,e.user_location.longitude?e.user_location.longitude:e.user_location.lon),mapTypeId:google.maps.MapTypeId.ROADMAP};t=new google.maps.Map(document.getElementById("map"),l),n=new OverlappingMarkerSpiderfier(t);var d=new google.maps.InfoWindow;o(t)}function g(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:34.024212,lng:-118.496475},zoom:10,scrollwheel:!1})}o.setting.layout.pageContentWithoutPadding=!0,e.rooms=[],$(".modal-backdrop").remove(),e.gridWidth=220,e.gutterWidth=20,$(window).width()<768&&(e.gridWidth=145,e.gutterWidth=8),e.showRooms=function(){e.sellyxKey=i.get("sellyxtoken"),e.user_location=i.getObject("userloc");var o={method:"GET",url:"https://chatting.sellyx.com/room/list?longitude="+(e.user_location.lon?e.user_location.lon:e.user_location.longitude)+"&latitude="+(e.user_location.lat?e.user_location.lat:e.user_location.latitude)+"&radius=10000000",headers:{authorization:e.sellyxKey},failure_message:!0};l.getapi(o).then(function(o){if(o.success)if(e.rooms=o.success.data,e.rooms.length>0){for(var t={},n=0;n<e.rooms.length;n++)e.rooms[n].product_id in t?(e.rooms.splice(n,1),n-=1):t[e.rooms[n].product_id]=n;m()}else g();else $("#login_modal").modal("show"),e.url=encodeURIComponent(a.url()),g()},function(o){})["finally"](function(){})},e.viewRoom=function(o){a.path("/chat").search({key:o})},e.viewDemo=function(o){a.path("/chat").search({key:o})},e.viewProduct=function(t){o.listingRoute=!0,e.productId=t,a.path("/listings").search({l:e.productId})},e.viewUser=function(o,t){e.userId=o,a.path("/user").search({u:e.userId,t:t})},e.$watch(function(){return a.search()},function(o){void 0!=o&&(e.active={tab:!0})}),e.sortBy=function(o,t){e.searchObject=$.extend(a.search(),{sort:o,rank:t}),a.search(e.searchObject)}}]);